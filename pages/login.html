<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0,shrink-to-fit=no, viewport-fit=cover">
    <meta name="keywords" content="蓝桥到家">
    <meta name="description" itemprop="description" content="生鲜副食、饮品乳品、鲜花蛋糕">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录</title>
    <link rel="stylesheet" type="text/css" href="../styles/reset.css" />
    <link rel="stylesheet" type="text/css" href="../styles/login.css">
    <link rel="stylesheet" type="text/css" href="../styles/common.css" />
    <script src="../js/common.js"></script>
    <script src="../js/zepto.min.js"></script>
</head>

<body>
<div class="wrap">
    <div class="container">
        <!-- logo start-->
        <div class="header_logo">
            <img src="https://static.shiyanlou.com/lanqiao/frontend/dist/img/lanqiao-logo.1bbdf85.svg" />
        </div>
        <!-- logo end -->

        <ul class="login_tab">
            <li class="cur"> <span>验证码登录</span> </li>
            <li> <span>密码登录</span> </li>
        </ul>
        <!-- 登录 start-->
        <ul class="login_show">
            <li class="cur">
                <div class="login_item">
                    <span class="login_text">手机号</span>
                    <input class="login_input" id="codeLoginPhone" type="tel" maxlength="11" value="18712341234" placeholder="输入手机号" />
                </div>
                <div class="login_item">
                    <span class="login_text">验证码</span>
                    <div class="auth_div">
                        <input class="login_input" id="loginCode" type="text" maxlength="6" placeholder="输入验证码" />
                        <div class="code">
                            <span>获取验证码</span>
                        </div>
                    </div>
                </div>
                <div class="login_button">
                    <a href="javascript:;" id="codeLoginBtn"><span>登录</span></a>
                </div>
            </li>
            <li>
                <div class="login_item">
                    <span class="login_text">手机号</span>
                    <input class="login_input" id="pwdLoginPhone" type="tel" maxlength="11" placeholder="输入手机号" />
                </div>
                <div class="login_item">
                    <span class="login_text">密码</span>
                    <input class="login_input" id="loginPassword" type="password" maxlength="12" placeholder="输入密码" />
                </div>
                <div class="login_button">
                    <a href="javascript:;" id="pwdLoginBtn"><span>登录</span></a>
                </div>
            </li>
        </ul>
        <!-- 登录 end-->
        <div class="register_div">
            <a class="register_text" href="register.html">注册账号</a></div>
    </div>
</div>
<!-- 替换原script标签内的代码 -->
<script>
    $(function() {
        // 切换登录类型（保持不变）
        $('.login_tab li').click(function() {
            if ($(this).hasClass('cur')) {
                return;
            }
            $(this).addClass('cur').siblings().removeClass('cur');
            var i = $(this).index();
            $(".login_show > li").eq(i).addClass('cur').siblings().removeClass('cur');
        });

        // 验证码登录（改为请求JSON Server）
        $('#codeLoginBtn').click(function() {
            const phone = $('#codeLoginPhone').val().trim();
            const code = $('#loginCode').val().trim();

            if (!phone || phone.length !== 11) {
                alert('请输入有效的手机号');
                return;
            }

            if (code !== '123456') {
                alert('验证码错误，请输入123456');
                return;
            }

            // 从JSON Server查询用户
            $.get('http://localhost:3000/users?phone=' + phone, function(users) {
                if (users.length === 0) {
                    alert('该手机号未注册，请先注册');
                    return;
                }
                // 登录成功，记录状态并跳转
                localStorage.setItem('loggedInUser', phone); // 仅记录登录状态，不存储完整数据
                window.location.href = '../index.html';
            }).fail(function(xhr) {
                alert('登录失败：' + xhr.statusText);
            });
        });

        // 密码登录（改为请求JSON Server）
        $('#pwdLoginBtn').click(function() {
            const phone = $('#pwdLoginPhone').val().trim();
            const password = $('#loginPassword').val().trim();

            if (!phone || phone.length !== 11) {
                alert('请输入有效的手机号');
                return;
            }

            if (!password) {
                alert('请输入密码');
                return;
            }

            // 从JSON Server查询匹配的用户
            $.get('http://localhost:3000/users?phone=' + phone + '&password=' + password, function(users) {
                if (users.length === 0) {
                    alert('手机号或密码错误');
                    return;
                }
                // 登录成功，记录状态并跳转
                localStorage.setItem('loggedInUser', phone);
                window.location.href = '../index.html';
            }).fail(function(xhr) {
                alert('登录失败：' + xhr.statusText);
            });
        });
    });
</script>
</body>

</html>